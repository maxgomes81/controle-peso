<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Controle de Peso</title>
  <meta name="theme-color" content="#111827" />
  <link rel="icon" href="icons/icon-192.png">
  <link rel="manifest" href="manifest.webmanifest">
  <link rel="stylesheet" href="styles.css" />
</head>

<body>
  <header class="header">
    <div>
      <h1>Controle de Peso</h1>
      <p class="muted">Offline • Instalável • Perfis • Calorias • Lembretes</p>
    </div>
    <div class="row">
      <select id="profileSelect" class="select" aria-label="Selecionar perfil"></select>
      <button id="manageProfilesBtn" class="btn secondary" type="button">Perfis</button>
      <button id="installBtn" class="btn secondary hidden" type="button">Instalar</button>
    </div>
  </header>

  <main class="container">
    <section class="card">
      <div class="row between">
        <h2>Novo registro</h2>
        <div class="muted small" id="activeProfileLabel"></div>
      </div>

      <form id="entryForm" class="grid" autocomplete="off">
        <label>
          Data
          <input id="dateInput" type="date" required />
        </label>

        <label>
          Peso (kg)
          <input id="weightInput" type="number" inputmode="decimal" step="0.1" min="20" max="400" placeholder="Ex.: 86.4" required />
        </label>

        <label>
          Cintura (cm) <span class="muted small">(opcional)</span>
          <input id="waistInput" type="number" inputmode="decimal" step="0.1" min="30" max="200" placeholder="Ex.: 92.5" />
        </label>

        <label>
          % Gordura <span class="muted small">(opcional)</span>
          <input id="bfInput" type="number" inputmode="decimal" step="0.1" min="1" max="80" placeholder="Ex.: 18.2" />
        </label>

        <label>
          Treino do dia <span class="muted small">(opcional)</span>
          <select id="workoutInput" class="select">
            <option value="">—</option>
            <option value="Descanso">Descanso</option>
            <option value="Musculação">Musculação</option>
            <option value="Cardio">Cardio</option>
            <option value="HIIT">HIIT</option>
            <option value="Outro">Outro</option>
          </select>
        </label>

        <label>
          Duração (min) <span class="muted small">(opcional)</span>
          <input id="workoutMinInput" type="number" inputmode="numeric" step="1" min="0" max="600" placeholder="Ex.: 45" />
        </label>

        <label class="span2">
          Observação (opcional)
          <input id="noteInput" type="text" maxlength="120" placeholder="Ex.: jejum, treino, retenção..." />
        </label>

        <div class="row span2">
          <button class="btn" type="submit">Salvar</button>
          <button id="clearBtn" class="btn secondary" type="button">Limpar</button>
        </div>
      </form>
    </section>

    <section class="card">
      <h2>Cadastro do perfil</h2>
      <form id="profileForm" class="grid" autocomplete="off">
        <label>
          Nome
          <input id="nameInput" type="text" maxlength="40" placeholder="Ex.: Maxwell" required />
        </label>

        <label>
          Idade (anos)
          <input id="ageInput" type="number" inputmode="numeric" step="1" min="10" max="120" placeholder="Ex.: 35" />
        </label>

        <label>
          Sexo <span class="muted small">(para cálculo)</span>
          <select id="sexInput" class="select">
            <option value="">—</option>
            <option value="M">Masculino</option>
            <option value="F">Feminino</option>
            <option value="X">Outro/Prefiro não informar</option>
          </select>
        </label>

        <label>
          Gênero <span class="muted small">(opcional)</span>
          <select id="genderInput" class="select">
            <option value="">—</option>
            <option value="Masculino">Masculino</option>
            <option value="Feminino">Feminino</option>
            <option value="Não-binário">Não-binário</option>
            <option value="Outro">Outro</option>
            <option value="Prefiro não informar">Prefiro não informar</option>
          </select>
        </label>

        <label>
          Raça/Cor <span class="muted small">(opcional)</span>
          <select id="raceInput" class="select">
            <option value="">—</option>
            <option value="Branca">Branca</option>
            <option value="Preta">Preta</option>
            <option value="Parda">Parda</option>
            <option value="Amarela">Amarela</option>
            <option value="Indígena">Indígena</option>
            <option value="Prefiro não informar">Prefiro não informar</option>
          </select>
        </label>

        <label>
          Telefone <span class="muted small">(opcional)</span>
          <input id="phoneInput" type="tel" maxlength="30" placeholder="Ex.: (69) 99999-9999" />
        </label>

        <label class="span2">
          Endereço <span class="muted small">(opcional)</span>
          <input id="addressInput" type="text" maxlength="120" placeholder="Ex.: Rua X, nº Y, Bairro, Cidade/UF" />
        </label>

        <label>
          Altura (cm)
          <input id="heightInput" type="number" inputmode="numeric" step="1" min="80" max="250" placeholder="Ex.: 175" />
        </label>

        <label>
          Meta (kg)
          <input id="goalInput" type="number" inputmode="decimal" step="0.1" min="20" max="400" placeholder="Ex.: 80.0" />
        </label>

        <label>
          Nível de atividade
          <select id="activityInput" class="select">
            <option value="1.2">Sedentário (1.2)</option>
            <option value="1.375">Leve (1.375)</option>
            <option value="1.55" selected>Moderado (1.55)</option>
            <option value="1.725">Alto (1.725)</option>
            <option value="1.9">Muito alto (1.9)</option>
          </select>
        </label>

        <label>
          Opção de treino
          <select id="trainingStyleInput" class="select">
            <option value="">—</option>
            <option value="Musculação">Musculação</option>
            <option value="Hipertrofia">Hipertrofia</option>
            <option value="Cardio">Cardio</option>
            <option value="Misto">Misto</option>
            <option value="HIIT">HIIT</option>
          </select>
        </label>

        <div class="span2">
          <div class="row between">
            <div>
              <div class="label">Dias de treino</div>
              <div class="muted small">Usado para gerar lembretes (calendário).</div>
            </div>
          </div>
          <div class="days" id="daysBox"></div>
        </div>

        <div class="row span2 wrap">
          <button id="saveProfileBtn" class="btn secondary" type="submit">Salvar cadastro</button>
          <button id="exportCsvBtn" class="btn secondary" type="button">Exportar CSV (perfil)</button>
          <button id="exportJsonBtn" class="btn secondary" type="button">Backup JSON (tudo)</button>
          <button id="importBtn" class="btn secondary" type="button">Importar JSON</button>
          <input id="importFile" type="file" accept="application/json" class="hidden" />
        </div>
        <p class="muted small span2">Os dados ficam no seu dispositivo (IndexedDB). Backup JSON restaura tudo. “Raça/Cor” é apenas cadastro e não entra nos cálculos.</p>
      </form>
    </section>

    <section class="card">
      <h2>Calorias (estimativa)</h2>
      <div class="stats">
        <div class="stat">
          <div class="label">BMR (repouso)</div>
          <div class="value" id="bmr">—</div>
        </div>
        <div class="stat">
          <div class="label">TDEE (manutenção)</div>
          <div class="value" id="tdee">—</div>
        </div>
        <div class="stat">
          <div class="label">Perder ~0,5 kg/sem</div>
          <div class="value" id="cut">—</div>
        </div>
        <div class="stat">
          <div class="label">Perder ~0,25 kg/sem</div>
          <div class="value" id="cutLite">—</div>
        </div>
        <div class="stat">
          <div class="label">Ganhar ~0,25 kg/sem</div>
          <div class="value" id="bulkLite">—</div>
        </div>
        <div class="stat">
          <div class="label">Ganhar ~0,5 kg/sem</div>
          <div class="value" id="bulk">—</div>
        </div>
      </div>
      <p class="muted small">
        Estimativas baseadas em Mifflin-St Jeor + fator de atividade. Não é aconselhamento médico.
      </p>
    </section>

    <section class="card">
      <h2>Lembretes (notificações)</h2>
      <p class="muted small">
        Em PWA no Android, notificação automática diária pode falhar por restrições do sistema. O jeito mais confiável aqui é gerar um <b>arquivo de calendário (.ics)</b> com alertas no Google Agenda.
      </p>

      <div class="grid">
        <label>
          Horário do lembrete de pesagem
          <input id="weighTime" type="time" value="07:00" />
        </label>

        <label>
          Horário do lembrete de treino
          <input id="trainTime" type="time" value="18:00" />
        </label>

        <div class="row span2 wrap">
          <button id="icsWeighBtn" class="btn secondary" type="button">Gerar .ICS Pesagem (diário)</button>
          <button id="icsTrainBtn" class="btn secondary" type="button">Gerar .ICS Treino (semanal)</button>
        </div>
      </div>
    </section>

    <section class="card">
      <h2>Resumo</h2>
      <div class="stats">
        <div class="stat">
          <div class="label">Último peso</div>
          <div class="value" id="lastWeight">—</div>
        </div>
        <div class="stat">
          <div class="label">Variação</div>
          <div class="value" id="delta">—</div>
        </div>
        <div class="stat">
          <div class="label">Média 7 dias</div>
          <div class="value" id="avg7">—</div>
        </div>
        <div class="stat">
          <div class="label">Tendência (7d)</div>
          <div class="value" id="trend7">—</div>
        </div>
        <div class="stat">
          <div class="label">IMC</div>
          <div class="value" id="bmi">—</div>
        </div>
        <div class="stat">
          <div class="label">Meta</div>
          <div class="value" id="goal">—</div>
        </div>
        <div class="stat">
          <div class="label">Falta p/ meta</div>
          <div class="value" id="toGoal">—</div>
        </div>
        <div class="stat">
          <div class="label">Cintura</div>
          <div class="value" id="waistLast">—</div>
        </div>
        <div class="stat">
          <div class="label">% Gordura</div>
          <div class="value" id="bfLast">—</div>
        </div>
      </div>

      <canvas id="chart" height="180" aria-label="Gráfico do peso (últimos 90 registros)"></canvas>
      <p class="muted small">
        Linhas: <b>Peso</b> + <b>Média móvel 7 dias</b> + <b>Meta</b> (se definida).
      </p>
    </section>

    <section class="card">
      <div class="row between">
        <h2>Histórico</h2>
        <div class="row wrap">
          <button id="deleteProfileBtn" class="btn danger" type="button">Apagar perfil</button>
          <button id="deleteAllBtn" class="btn danger" type="button">Apagar tudo</button>
        </div>
      </div>

      <div id="list" class="list"></div>
    </section>
  </main>

  <footer class="footer muted small">
    Privacidade: dados ficam locais no seu dispositivo. Faça Backup JSON regularmente.
  </footer>

  <!-- modal perfis -->
  <dialog id="profilesDialog" class="dialog">
    <div class="dialogCard">
      <div class="row between">
        <h3>Perfis</h3>
        <button id="closeProfilesBtn" class="iconbtn" type="button">Fechar</button>
      </div>
      <p class="muted small">Crie perfis para separar os registros (ex.: você e outra pessoa).</p>

      <div class="row wrap">
        <button id="newProfileBtn" class="btn secondary" type="button">Novo perfil</button>
        <button id="renameProfileBtn" class="btn secondary" type="button">Renomear</button>
      </div>

      <div class="muted small" style="margin-top:10px">
        Para excluir, use “Apagar perfil” (na tela principal) com o perfil selecionado.
      </div>
    </div>
  </dialog>

  <script src="app.js"></script>
</body>
</html>
